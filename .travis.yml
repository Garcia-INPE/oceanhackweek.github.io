language: minimal

sudo: false

env:
  global:
    # Doctr deploy key for oceanhackweek/oceanhackweek.github.io
    - secure: "lyjjh4qQiVvq5wN6NLEvlDLmMGlhi3O2h+V3MVH9Lns6jmW0JdVByDFkVFesGITwEpEpFCZhHhe7ObYqOtkk9bVdVEN3vvSRNdZDbMVF5+8dHvoRo6WO6MLroO+olIHF8bXS6u6W+yofRiiFibsEkyBwx25YAlo9M6iH2DANFMx2JXoyX+ai9JRoUc4v8JWR97Y39zBYghAJd5PgCU3HFQpal6uNcMNJXFTq9mqJ5qF/ZPgwtVUbnSzQtwWxSGIU97Mj816fX6DlekMI0XpZKiYGUBj+9b2sUtsee+VMVgbAufqSihj1Fxh/sJ9iuObkN99SGJxMg5oWyBqluyqWP/aX048h/9/RyJTgC9piN6CJYoT+C5Fy0gay1041yO90yZsSjtOB6jNPSBRTaOoKvG1033YgQzQEmMZI6e8Wi9SteLXwnp3WS61O5fPX3uLu1VVT03qZsq9yfibn0nSBhmjCDmSLU/SJyWeY/V+ekWbeaoVpp7d4+SdpV2Bwfuas+sQkU99UDWkzvu8qeGGPHkndJldCXGwQkBeuRXPi4Re6IKw0HR53wEJ+MY++dil3ldA4KBqn1iN56QzqwZVTpcUANoyswo0dWD93m5zo71Is8jI6VrluV8JeVmqWXfZjBaujc1QrECzGpvL/s9TwezG8sAB0CKQcpZ8BwD+1YcU="

before_install:
  # Install miniconda and create TEST env.
  - |
    wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh -O miniconda.sh
    bash miniconda.sh -b -p $HOME/miniconda
    export PATH="$HOME/miniconda/bin:$PATH"
    conda config --set always_yes yes --set changeps1 no --set show_channel_urls true
    conda update --quiet conda
    conda config --add channels conda-forge --force
    conda config --set channel_priority strict
    conda config --set safety_checks disabled
    conda create --name TEST python=3 rb-bundler compilers doctr
    source activate TEST
    bundle install

install:
  - bundle exec jekyll build --verbose

script:
  - |
    set -e
    if [[ -z "$TRAVIS_TAG" ]]; then
      DEPLOY_DIR=dev
    else
      DEPLOY_DIR="version-$TRAVIS_TAG"
    fi
    python -m doctr deploy --build-tags --key-path github_deploy_key_oceanhackweek_oceanhackweek_github_io.enc --built-docs _site/ $DEPLOY_DIR
    python -m doctr deploy --build-tags --key-path github_deploy_key_oceanhackweek_oceanhackweek_github_io.enc --built-docs _site/ .

doctr:
  require-master: true
  sync: false
