language: minimal

sudo: false

env:
  global:
    # Doctr deploy key for oceanhackweek/oceanhackweek.github.io
    - secure: "EjC+PdnyrYNtX++XFFWNGm62KJq/kktGGj5ujhKGCcleGMI3sVSA8UEHZZOeahX/CTu/TfTcJhkieD4gJ0S7GvWxE8kVi02z/lP1LwNw3NFtNvCQ91KU+66U6vVe/JmyVY8JfhZmL3PzjNR19UaJ+54R+j1pt+KpIMyWwuAROc4bNTK55EIPQfN4IYnuuphLPrNtJV0ka49RI5mJ8dYI8nioz3lbfJ4ydp1/BaBQ9YOWdEddhV5+0/mp7TEc9kG5Mq8Vzzp66RexUq5iQingF3gzgm3RyOKdygEbM0E6Zt5TwRBK9eV6Z5nF0VRSlTlEbx0TzyDxMYpycVx056GDR7RLio8ftndqtkKLnAjmilBvelaWMGWnqbkvux6OQfwETmf1q0wRMTKmMJz+QRicmP3Z4rWJuZc04IYoI2aZrVR2EBpLUI5L5Ul/req1EOkcluLEKuAeU2glH+BikK4iQjZE40Sb998ezejm0bnYIkEJigfIuHz4n5SyrG7zhG15AwIuZTgvQiulF3PV7aKOgSfhnSaJd0t+5YrKipdk6M2aKfuScKJHfi/79RcJoQIv1CfPvLpDilzhdH4qZ9IhaPx2jNw8/oQw8WjTVylMu8vMDC0SY5Au2ypoXnuCPOzPnXb8ZsZqYhMCU1beM145OaCjAnyLg+7wImWI7+AHgfQ="

before_install:
  # Install miniconda and create TEST env.
  - |
    wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh -O miniconda.sh
    bash miniconda.sh -b -p $HOME/miniconda
    export PATH="$HOME/miniconda/bin:$PATH"
    conda config --set always_yes yes --set changeps1 no --set show_channel_urls true
    conda update --quiet conda
    conda config --add channels conda-forge --force
    conda config --set channel_priority strict
    conda create --name TEST python=3 rb-bundler compilers doctr
    source activate TEST
    bundle install

install:
  - bundle exec jekyll build --verbose

script:
  - |
    set -e
    if [[ -z "$TRAVIS_TAG" ]]; then
      DEPLOY_DIR=dev
    else
      DEPLOY_DIR="version-$TRAVIS_TAG"
    fi
    python -m doctr deploy --branch-whitelist source --build-tags --key-path github_deploy_key_oceanhackweek_oceanhackweek_github_io.enc --built-docs _site/ $DEPLOY_DIR
    python -m doctr deploy --branch-whitelist source --build-tags --key-path github_deploy_key_oceanhackweek_oceanhackweek_github_io.enc --built-docs _site/ .

doctr:
  require-master: true
  sync: false
